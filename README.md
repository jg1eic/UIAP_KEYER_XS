# UIAP_KEYER_XS for CH32V003

UIAPduino(CH32V003) マイコンを使用した、  
**アマチュア無線向け CW（モールス）キーヤー**です。

UIAPduino / Arduino 系キーヤーをベースに、  
`ch32v003fun` フレームワーク向けに移植・拡張しています。

OLED 表示、メモリー送信、編集機能、システムメッセージ再生などを備えています。

---

## 特徴（Features）

- 🟢 CH32V003F4P6 対応（48MHz）
- 🟢 iambic パドル入力対応
- 🟢 可変 WPM（ボリューム入力）
- 🟢 OLED 表示（SSD1306 / I2C）
- 🟢 メモリー送信（2メモリー）
- 🟢 メモリー編集機能（パドル＋スイッチ）
- 🟢 Flash EEPROM へのメッセージ保存
- 🟢 起動時システムメッセージ送信（例：`OK`）
- 🟢 システムメッセージ時は RF キーイングしない安全設計

---

## 動作モード（Modes）

| モード | 説明 |
|------|------|
| KEYER | 通常のパドルキーイング |
| PLAY | メモリー送信中 |
| EDIT_SELECT | 編集するメモリー選択 |
| EDIT | メモリー内容の編集 |
| SETUP | （将来拡張用） |

---

## ハードウェア構成（Example）

- MCU : **CH32V003F4P6**
- OLED : **SSD1306 (128x64, I2C)**
- 入力
  - DOT パドル
  - DASH パドル
  - SW1 / SW2（操作用）
  - 可変抵抗（WPM 調整）
- 出力
  - トーン出力
  - KEYOUT（無線機キーイング）

※ ピン割り当ては `keyer_hal.h` を参照してください。

---

## 基本操作（Usage）

### 通常キーイング

- パドル操作で CW 送信
- ボリュームで WPM 変更（約 5～40 WPM）

OLED には現在のモードと WPM が表示されます。

---

### メモリー送信

| 操作 | 内容 |
|----|----|
| SW1 クリック | メモリー1 再生 |
| SW2 クリック | メモリー2 再生 |
| パドル or SW 操作 | 再生中断 |

---

### メモリー編集

1. **SW1 + SW2 同時クリック**  
   → EDIT_SELECT モードへ

2. 編集するメモリーを選択  
   - SW1 : MSG1  
   - SW2 : MSG2  

3. EDIT モード操作  

#### EDIT モード操作

| 操作 | 内容 |
|----|----|
| DOT パドル | 文字を戻す |
| DASH パドル | 文字を進める |
| SW2 クリック | 文字確定（カーソル右） |
| SW1 クリック | カーソル左 |
| SW1 長押し | カーソル以降削除 |
| SW2 長押し | 保存して終了 |

編集したメッセージは **Flash EEPROM** に保存され、  
次回起動時も保持されます。

---

## システムメッセージ

- 起動時に `OK` を **20WPM** で再生
- システムメッセージ中：
  - トーンは鳴る
  - **KEYOUT は出力しない**（RF 送信しない）

主に以下用途を想定しています：

- 起動確認
- モード切替通知
- エラー／状態通知

---

## 開発環境

- PlatformIO
- Framework : `ch32v003fun`
- Compiler : riscv-gcc
- Library
  - ssd1306
  - flash_eep

---

## ビルド方法（PlatformIO）

```bash
platformio run
platformio run --target upload

